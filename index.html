<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MJ AUTO SALES Â· CatÃ¡logo</title>
  <style>
    :root{--bg:#0b0c10; --card:#121317; --ink:#e8e8e8; --muted:#a8a8a8; --accent:#00d1ff; --gap:16px; --radius:14px; --shadow:0 6px 18px rgba(0,0,0,.25)}
    body.theme-light{--bg:#f6f7f9; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --accent:#0ea5e9}
    body.theme-light .controls input, body.theme-light .controls select, body.theme-light .controls button{border-color:#d8dee9;background:#f1f5f9;color:var(--ink)}
    body.theme-light .card{border-color:#e2e8f0}
    body.theme-light header{background:linear-gradient(180deg,#f6f7f9 60%,transparent)}

    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,#0b0c10 60%,transparent);backdrop-filter:saturate(1.2) blur(6px);}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}

    .title{display:flex;align-items:center;gap:12px}
    .logo{border-radius:10px;box-shadow:var(--shadow)}
    h1{font-size:24px;margin:0}
    .title .theme{margin-left:auto;padding:8px 10px;border-radius:10px;border:1px solid #1e293b;background:#16202e;color:var(--ink);cursor:pointer}
    .title .theme:hover{border-color:var(--accent)}

    .controls{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:var(--gap);margin-top:16px}
    .controls input,.controls select,.controls button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #222;background:#101116;color:var(--ink);outline:none}
    .controls input::placeholder{color:#777}
    .controls button{cursor:pointer;border:1px solid #1e293b;background:#16202e}
    .controls button:hover{border-color:var(--accent)}

    .meta{display:flex;align-items:center;gap:10px;margin-top:12px;color:var(--muted);font-size:14px}

    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--gap);padding:24px 0}
    .card{background:var(--card);border:1px solid #1b1d24;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card .thumb{aspect-ratio:4/3;background:#0f1117;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .cap{padding:10px 12px;border-top:1px solid #1b1d24}
    .cap b{display:block;font-size:14px}
    .cap small{display:block;color:var(--muted);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .empty{padding:36px;text-align:center;color:var(--muted);border:1px dashed #2a2d36;border-radius:12px}
    .loading{opacity:.8;animation:pulse 1.2s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}

    footer{border-top:1px solid #1b1d24;color:#9aa0a6}
    a.inline{color:var(--accent);text-decoration:none}

    @media (max-width:720px){
      .controls{grid-template-columns:1fr 1fr;grid-auto-rows:auto}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <!-- Logo texto+icono -->
        <svg class="logo" width="36" height="36" viewBox="0 0 64 64" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#00d1ff"/>
              <stop offset="1" stop-color="#6cff7d"/>
            </linearGradient>
          </defs>
          <rect rx="10" width="64" height="64" fill="url(#g)"/>
          <path d="M10 36c3-8 10-12 18-12h8c8 0 15 4 18 12" fill="none" stroke="#0b0c10" stroke-width="3"/>
          <circle cx="20" cy="42" r="4" fill="#0b0c10"/>
          <circle cx="44" cy="42" r="4" fill="#0b0c10"/>
        </svg>
        <h1>MJ AUTO SALES Â· CatÃ¡logo</h1>
        <button id="themeToggle" class="theme" aria-label="Cambiar tema" title="Cambiar tema">ðŸŒ“</button>
      </div>

      <div class="controls" role="group" aria-label="Filtros de catÃ¡logo">
        <input id="q" type="search" placeholder="Buscar (marca, modelo o archivo)" autocomplete="off" />
        <select id="brand">
          <option value="">Todas las marcas</option>
        </select>
        <select id="model" disabled>
          <option value="">Todos los modelos</option>
        </select>
        <button id="clear">Limpiar</button>
      </div>

      <div class="meta">
        <span id="count" class="loading">Cargando catÃ¡logoâ€¦</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section id="gallery" class="gallery" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>No hay resultados con los filtros actuales.</div>
  </main>

  <footer>
    <div class="wrap" style="padding-bottom:32px">
      <small>Coloca <code>autos.json</code> y tus carpetas de imÃ¡genes en la raÃ­z de tu repositorio de GitHub Pages. Las rutas del JSON ya apuntan a los archivos correctos.</small>
    </div>
  </footer>

  <script>
    const els = {
      q: document.getElementById('q'),
      brand: document.getElementById('brand'),
      model: document.getElementById('model'),
      clear: document.getElementById('clear'),
      count: document.getElementById('count'),
      gallery: document.getElementById('gallery'),
      empty: document.getElementById('empty'),
    };

    /** Utilidades **/
    const debounce = (fn, delay=200) => { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); }; };

    /** Estado **/
    let ITEMS = []; // {brand, model, path, file}

    /** Renderizado **/
    function render(items){
      els.gallery.innerHTML = '';
      if(!items.length){ els.empty.hidden = false; els.count.textContent = '0 resultados'; return; }
      els.empty.hidden = true;
      const frag = document.createDocumentFragment();
      for(const it of items){
        const card = document.createElement('article'); card.className = 'card';
        const a = document.createElement('a'); a.className = 'thumb'; a.href = it.path; a.target = '_blank'; a.rel = 'noopener';
        const img = document.createElement('img'); img.loading = 'lazy'; img.alt = `${it.brand} ${it.model}`; img.src = it.path; a.appendChild(img);
        const cap = document.createElement('div'); cap.className = 'cap';
        const b = document.createElement('b'); b.textContent = `${it.brand} Â· ${it.model}`;
        const sm = document.createElement('small'); sm.title = it.file; sm.textContent = it.file;
        cap.appendChild(b); cap.appendChild(sm);
        card.appendChild(a); card.appendChild(cap);
        frag.appendChild(card);
      }
      els.gallery.appendChild(frag);
      els.count.textContent = `${items.length} ${items.length===1?'resultado':'resultados'}`;
    }

    /** Filtros **/
    function applyFilters(){
      const q = els.q.value.trim().toLowerCase();
      const brand = els.brand.value; const model = els.model.value; let out = ITEMS;
      if(brand) out = out.filter(i => i.brand === brand);
      if(model) out = out.filter(i => i.model === model);
      if(q){ out = out.filter(i => i.brand.toLowerCase().includes(q) || i.model.toLowerCase().includes(q) || i.file.toLowerCase().includes(q)); }
      render(out);
    }

    /** Poblar selects **/
    function populateBrandAndModel(items){
      const brands = Array.from(new Set(items.map(i => i.brand))).sort((a,b)=>a.localeCompare(b,'es'));
      els.brand.innerHTML = '<option value="">Todas las marcas</option>' + brands.map(b=>`<option value="${b}">${b}</option>`).join('');
      els.model.innerHTML = '<option value="">Todos los modelos</option>'; els.model.disabled = true;
      els.brand.addEventListener('change', () => {
        const b = els.brand.value;
        const models = Array.from(new Set(items.filter(i => !b || i.brand===b).map(i => i.model))).sort((a,b)=>a.localeCompare(b,'es'));
        els.model.innerHTML = '<option value="">Todos los modelos</option>' + models.map(m=>`<option value="${m}">${m}</option>`).join('');
        els.model.disabled = false; els.model.value = '';
        applyFilters();
      });
      els.model.addEventListener('change', applyFilters);
    }

    /** Eventos **/
    els.q.addEventListener('input', debounce(applyFilters, 180));
    els.clear.addEventListener('click', () => { els.q.value = ''; els.brand.value = ''; els.model.value = ''; els.model.disabled = true; applyFilters(); });

    // GestiÃ³n de tema (claro/oscuro)
    const THEME_KEY = 'mj-theme';
    function applyTheme(t){ document.body.classList.toggle('theme-light', t==='light'); }
    const saved = localStorage.getItem(THEME_KEY) || 'dark'; applyTheme(saved);
    document.getElementById('themeToggle').addEventListener('click', () => {
      const next = document.body.classList.contains('theme-light') ? 'dark' : 'light';
      localStorage.setItem(THEME_KEY, next); applyTheme(next);
    });

    /** Cargar autos.json **/
    fetch('autos.json', {cache:'no-store'})
      .then(r => { if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); })
      .then(data => {
        const items = [];
        for(const brand of Object.keys(data)){
          const models = data[brand];
          for(const model of Object.keys(models)){
            for(const path of models[model]){
              const file = path.split('/').pop();
              items.push({brand, model, path, file});
            }
          }
        }
        ITEMS = items; populateBrandAndModel(ITEMS); render(ITEMS);
      })
      .catch(err => {
        console.error('Error cargando autos.json', err);
        els.count.textContent = 'No se pudo cargar autos.json';
        els.gallery.innerHTML = '';
        els.empty.hidden = false; els.empty.textContent = 'No se encontrÃ³ autos.json en la raÃ­z. Sube el archivo junto a index.html.';
      });
  </script>
</body>
</html>
